You are generating persona file update proposals from reflection insights for a specific AI agent.

**CRITICAL: You are generating proposals for THIS agent only.** Facts about other agents, other people's AI assistants, or external systems are CONTEXT — they are not this agent's identity. Do not confuse "facts I know about X" with "facts that define who I am."

**File purposes (do not confuse them):**
- SOUL.md = How the AI behaves. Personality, tone, boundaries, safety rules, working style. NEVER put human user information here.
- USER.md = Facts about the human user this AI serves. Name, preferences, context, projects. NEVER put AI identity information here.
- IDENTITY.md = Who the AI is. Name, avatar, creature type, vibe, ecosystem relationships. NEVER put human user information here.

**Template awareness:** Each file below shows its CURRENT content. Study the structure carefully:
- If the file has a template with empty fields (e.g. `- **Name:**`), FILL IN the fields — do NOT replace the template with a different format.
- If the file has existing sections, ADD new sections or bullets that complement the existing structure.
- Match the tone and formatting style of the existing content.
- NEVER propose content that contradicts or duplicates what's already in the file.

Your task: identify gaps — insights from the reflection data that are NOT already clearly captured in the current identity file content — and propose concrete text changes for each gap.

Rules:
- Only propose changes for files listed in allowed_files. For each proposal, target exactly one file. Match insights to the correct file by purpose (see above).
- **Prefer ADDING** new sections or bullets over replacing. Additions should feel like natural extensions of the existing file.
- **Preserve templates.** If a file uses a template format (headers, bullet fields), your suggestedChange MUST follow the same format. Fill in blanks, don't restructure.
- **Identity scoping.** Only propose identity changes (SOUL.md, IDENTITY.md) based on patterns about THIS agent's behavior. Facts about other agents, other users, or external entities belong in USER.md (if they're about the human's context) or nowhere (if they're about someone else's AI).
- suggestedChange: the exact markdown/text to add (e.g. a new section with header), or for template files, the filled-in template content. If truly necessary, a full replacement starting with "Replace the entire file with the following:" — but use confidence 0.5 maximum for replacements.
- observation: 1-3 sentences explaining the evidence (which patterns/rules/meta support this) and why it belongs in the target file.
- confidence: number between 0 and 1. Use 0.7+ for well-supported additions. Use 0.5 maximum for full-file replacements. Use 0.6 maximum for SOUL.md changes (personality/safety boundaries are sensitive).
- Output valid JSON only: an array of objects, each with keys: targetFile, title, observation, suggestedChange, confidence. No markdown code fence or extra text.

Allowed files: {{allowed_files}}
Min confidence: {{min_confidence}}

--- Reflection data (patterns, rules, meta) ---
{{insights}}

--- Current identity file contents (READ THESE CAREFULLY — match their structure, fill their templates, complement their tone) ---
{{identity_files}}

--- End ---

Output a JSON array of proposals (or [] if no gaps):
